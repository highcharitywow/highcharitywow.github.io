<html>
<head>
	<title> Player Details - High Charity DKP (Classic WoW Incendius)</title>
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
	<script src="https://momentjs.com/downloads/moment.min.js"></script>
	<link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
	<script>var whTooltips = {colorLinks: true, iconizeLinks: true, renameLinks: true};</script>
	<script src="https://wow.zamimg.com/widgets/power.js"></script>
</head>
<script type="text/javascript">
	function getDKPHistory(id) {
		var historyEntries = [];
		$.getJSON('dkphistory.json', function (json) {
			for (var i = 0; i < json.dkphistory.historyentry.length; i++) {
				if (json.dkphistory.historyentry[i].playerstring.indexOf(id+',') > -1) {
					json.dkphistory.historyentry[i].playerstring = id;
					json.dkphistory.historyentry[i].timestamp = moment.unix(json.dkphistory.historyentry[i].timestamp).format('LLL');
					historyEntries.push(json.dkphistory.historyentry[i]);
				}
			}
			return $('#dkphistory').DataTable({
				data: historyEntries,
				columns: [
					{ data: 'dkp' },
					{ data: 'timestamp' },
					{ data: 'reason' }
				]
			});
		});

	}

	function getLootHistory(id) {
		$.getJSON('loothistory.json', function (json) {
			for (var i = 0; i < json.loothistory.lootentry.length; i++) {
				if (json.loothistory.lootentry[i].player.indexOf(id) > -1) {
					json.loothistory.lootentry[i].timestamp = moment.unix(json.loothistory.lootentry[i].timestamp).format('LLL');
					
					$('#loothistory tbody').append('<tr><td><a href="/beta/item.html?id='+
					json.loothistory.lootentry[i].itemnumber+'" data-wowhead="item='+
					json.loothistory.lootentry[i].itemnumber+'">'+
					json.loothistory.lootentry[i].itemname+'</a></td><td>' +
					json.loothistory.lootentry[i].zone+'</td><td>' +
					json.loothistory.lootentry[i].boss+'</td><td>' +
					json.loothistory.lootentry[i].timestamp+'</td><td>' +
					json.loothistory.lootentry[i].cost+'</td></tr>');
				}
			}
			return dkpTable = $('#loothistory').DataTable();
		});

	}

	$(document).ready(function() {
		//id = playername
		var url = new URL(window.location.href);
		var id = url.searchParams.get('id');
		$('.playerName').text(id);
		var dkphistory = getDKPHistory(id);
		var loothistory = getLootHistory(id);		
		
	});	
</script>
<body>

<h4>DKP History for <span class="playerName"></span></h4>
<table id="dkphistory" class="display" style="width:100%">
<thead>
<tr><th>DKP</th><th>Timestamp</th><th>Reason</th></tr>
</thead>
<tfoot>
<tr><th>DKP</th><th>Timestamp</th><th>Reason</th></tr>
</tfoot>
</table>

<h4>Loot History for <span class="playerName"></span></h4>
<table id="loothistory" class="display" style="width:100%">
<thead>
<tr><th>Item Name</th><th>Zone</th><th>Boss</th><th>Date</th><th>Cost</th></tr>
</thead>
<tbody></tbody>
<tfoot>
<tr><th>Item Name</th><th>Zone</th><th>Boss</th><th>Date</th><th>Cost</th></tr>
</tfoot>
</table>
</body>
</html>